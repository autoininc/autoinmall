<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" id="bootstrap-css" rel="stylesheet">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!------ Include the above in your HEAD tag ---------->

<!DOCTYPE html>
<html>
<head>
	<title>Cart</title>
	<link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
		  rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<%- include('head') %>
	<link href="/css/cart.css" rel="stylesheet">

</head>
<!--Coded with love by Mutiullah Samim-->

<body>
	<%- include('body_nav') %>
	<br><br><br><br>
	<div class="container">
		<div id="change_tag">
			<ul>
				<li id="cart"><a class="btn">Cart</a></li>
				<li id="receipt"><a class="btn">Receipt</a></li>
			</ul>
		</div>
		<div class="table-responsive" id="table_view">
			<table class="table table-bordered table-striped" id="cart_table">
				<thead>
				<tr>
					<th scope="col">#</th>
					<th scope="col">Item</th>
					<th scope="col">Parts Number</th>
					<th scope="col">Quantity</th>
					<th scope="col">Price</th>
					<th></th>
				</tr>
				</thead>
				<tbody>

				</tbody>

			</table>
			<form action="/order" method="POST">
				<div style="text-align: center;">
					<input class="btn btn-secondary" id="buy" type="submit" value="buy">
				</div>
			</form>
		</div>
		<div id="receipt_view" style="display: none;">
			<div id="receipt_list" style="margin-bottom:5%">
				<br><br>

				<table class="table table-bordered " id="receipt_table">
					<thead class="thead-dark">
					<tr>
						<th scope="col">Cart Id</th>
						<th scope="col">Date</th>
						<th scope="col">Order Number</th>
						<th colspan="2" scope="col">Item Name/PIN</th>

						<th scope="col">Quantity</th>
						<th scope="col">Price($)</th>

					</tr>
					</thead>
					<tbody>

					</tbody>
				</table>

			</div>
		</div>
	</div>
	<!-- Footer-->
	<%- include('footer') %>

	<!-- Core theme JS-->
	<script src="/js/cart.js"></script>

	<!--import -->
	<script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
	<script src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js" type="text/javascript"></script>

	<script>
		var username = '<%- username %>';
		var data = JSON.parse('<%- data %>');
		var receipt = JSON.parse('<%- receipt %>');
		if (data) {
			var length = data.length;
			var total = 0.0;
			for (var i = 0; i < length; i++) {
				if (data[i].PRICE !== "no data") {
					$("#cart_table tbody").append(
						'<tr id="temp">' +
						'<th scope="row">' + (i + 1) + '</th>' +
						'<td><a href="/item/info?pin=' + data[i].PIN + '" style="color:black;,text-decoration: none;">' + data[i].ITEM + '</a></td>' +
						'<td>' + data[i].PARTS_NUM + '</td>' +
						'<td>' + data[i].VOLUME + '</td>' +
						'<td>$ ' + Number(data[i].PRICE).toFixed(2) + '</td> ' +
						'<td><input type="button" class="btn btn-secondary delete" value="delete" id="temp_btn" onclick="on_click(' + i + ');"></td>' +
						'</tr>'
					)
				} else {
					$("#cart_table tbody").append(
						'<tr id="temp">' +
						'<th scope="row">' + (i + 1) + '</th>' +
						'<td><a href="/item/info?pin=' + data[i].PIN + '" style="color:black;,text-decoration: none;">' + data[i].ITEM + '</a></td>' +
						'<td>' + data[i].PARTS_NUM + '</td>' +
						'<td>' + data[i].VOLUME + '</td>' +
						'<td>N/A</td> ' +
						'<td><input type="button" class="btn btn-secondary delete" value="delete" id="temp_btn" onclick="on_click(' + i + ');"></td>' +
						'</tr>'
					)
				}

				if (!isNaN(data[i].PRICE)) {
					total = parseFloat(total) + parseFloat(Number(data[i].PRICE));
				}

				$("#temp").attr("id", i);
				$("#temp_btn").attr("id", "no." + String(i));

				//
			}
			$("#cart_table tbody").append(
				'<tr>' +
				'<th scope="row" colspan="4">TOTAL</th>' +
				'<td colspan="2">$ ' + total.toFixed(2) + '</td> ' +
				'<tr>'
			)
		}
		//navbar
		if (username) {
			$("#account_ctrl").html('Signout');
			$("#account_ctrl").attr("href", "/signout");
			$("#accountMenu").append('<a class="dropdown-item" style="color:white;" id="management" href="/management">Management</a>');
		} else {
			$("#account_ctrl").html('Signin');
			$("#account_ctrl").attr("href", "/signin");
			$("#accountMenu").remove("#management");
		}

		for (var j = 0; j < receipt.length; j++) {
			if (j === 0) {
				$("#receipt_table tbody").html(
					' <tr>' +
					'   <td rowspan="2">' + receipt[j].CART_ID + '</td>' +
					'  <td rowspan="2">' + receipt[j].DATE + '</td>' +
					' <td rowspan="2">' + receipt[j].ORDER_NUM + '</td>' +
					' <td colspan="2"><a style="color:black" href="/item/info?pin=' + receipt[j].PIN + '">' + receipt[j].ITEM_NAME + '</a></td>' +
					'<td rowspan="2">' + receipt[j].VOLUME + '</td>' +
					'<td rowspan="2">' + receipt[j].PRICE + '</td>' +
					'</tr>' +
					' <tr>' +
					'<td colspan="2"><a style="color:black" href="/item/info?pin=' + receipt[j].PIN + '">' + receipt[j].PIN + '</a></td>    ' +
					'</tr>'
				);
			} else {
				$("#receipt_table tbody").append(
					' <tr>' +
					'   <td rowspan="2">' + receipt[j].CART_ID + '</td>' +
					'  <td rowspan="2">' + receipt[j].DATE + '</td>' +
					' <td rowspan="2">' + receipt[j].ORDER_NUM + '</td>' +
					' <td colspan="2"><a style="color:black" href="/item/info?pin=' + receipt[j].PIN + '">' + receipt[j].ITEM_NAME + '</a></td>' +
					'<td rowspan="2">' + receipt[j].VOLUME + '</td>' +
					'<td rowspan="2">' + receipt[j].PRICE + '</td>' +
					'</tr>' +
					' <tr>' +
					'<td colspan="2"><a style="color:black" href="/item/info?pin=' + receipt[j].PIN + '">' + receipt[j].PIN + '</a></td>    ' +
					'</tr>'
				);
			}
		}

		function on_click(i) {
			$.ajax({
				url: "/cart/delete",
				type: "post",
				data: data[i],
				success: function (data) {
					location.reload();
				},
				error: () => {

				}
			})
		}


	</script>
</body>

</html>
