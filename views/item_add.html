<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>AUTOINMall</title>
    <link rel="icon" type="image/x-icon" href="../img/item/autoin_icon.png" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=NotoSans:500,700" rel="stylesheet" type="text/css" />
    <link href="../css/styles.css" rel="stylesheet" />

    <!--sweetalert2-->
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7.1.0/dist/promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/8.11.8/sweetalert2.all.min.js"rel="stylesheet">
    <!--swiper-->
    <link rel="stylesheet" href="https://unpkg.com/swiper@5.4.5/css/swiper.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper@5.4.5/css/swiper.min.css">
    <script src="https://unpkg.com/swiper@5.4.5/js/swiper.js"></script>
    <script src="https://unpkg.com/swiper@5.4.5/js/swiper.min.js"></script>

    <style>
        body {
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .swiper-container {
            background: silver;
            width: 100%;
            height: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .swiper-slide {
            background-size: cover;
            background-position: center;
        }

        .gallery-top {
            border-top: black solid 1px;
            border-left: black solid 1px;
            border-right: black solid 1px;
            margin-top: 7%;
            height: 60%;
            width: 100%;
        }

        .gallery-thumbs {
            border-bottom: black solid 1px;
            border-left: black solid 1px;
            border-right: black solid 1px;
            height: 20%;
            box-sizing: border-box;
            padding: 10px 0;
        }

        .gallery-thumbs .swiper-slide {
            height: 100%;
            opacity: 0.4;
        }

        .gallery-thumbs .swiper-slide-thumb-active {
            opacity: 1;
        }
    </style>

</head>

<body>
    <div class="container">
        <div class="row" id="item_info_row">
            <div class="col-sm-6">
                <!-- Swiper -->
                <div class="swiper-container gallery-top">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" id="top-img-0">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="top-img-1">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="top-img-2">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="top-img-3">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="top-img-4">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                    </div>
                    <!-- Add Arrows -->
                    <div class="swiper-button-next swiper-button-black"></div>
                    <div class="swiper-button-prev swiper-button-black"></div>
                </div>
                <div class="swiper-container gallery-thumbs">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" id="thumb-img-0">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="thumb-img-1">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="thumb-img-2">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="thumb-img-3">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                        <div class="swiper-slide" id="thumb-img-4">
                            <img src="../img/item/no_img.png" style="width: 100%;">
                        </div>
                    </div>
                </div>

                <div class="form-control-upload filebox" style="margin-top:15px">
                    <label for="item_img">사진 업로드</label>
                    <input type="file" display="none" class="filebox" accept="image/*" id="item_img" name="item_img" multiple />
                    <input type="text" class="upload-name-img" readonly="readonly" disabled="disabled" />
                </div>

            </div>

            <div class="col-sm-6" id="item_head">
                <form>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Item name</span></div>
                        <input type="text" name="item_name" id="item_name" class="form-control">
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Price</span></div>
                        <input type="text" name="item_price" id="item_price" class="form-control">
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Parts Num</span></div>
                        <input type="text" name="parts_num" id="parts_num" class="form-control">
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Quantity</span></div>
                        <input type="text" name="item_volume" id="item_volume" class="form-control">
                    </div>
                    <div class="input-group mb-1">

                        <span class="input-group-text">Model</span>
                        <input type="text" name="item_model" id="item_model" class="form-control">

                        <span class="input-group-text">Version</span>
                        <input type="text" name="item_version" id="item_version" class="form-control">
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Car Brand</span></div>
                        <select name="car_brand" class="custom-select" id="car_brand">
                            <option selected></option>
                        </select>
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Item Brand</span></div>
                        <select name="item_brand" class="custom-select" id="item_brand">
                            <option selected></option>
                        </select>
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Item manuf</span></div>
                        <input type="text" name="item_manuf" id="item_manuf" class="form-control">
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Category Main</span></div>
                        <select name="category_main" class="custom-select" id="category_main">
                            <option selected></option>
                        </select>
                    </div>
                    <div class="input-group mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Category Sub</span></div>
                        <select name="category_sub" class="custom-select" id="category_sub" disabled>
                            <option selected></option>
                        </select>
                    </div>
                </form>
            </div>

        </div>

        <div class="input-group mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text">Download Files</span>
            </div>
            <div class="form-control-upload filebox" >
                <label for="item_file" >파일 업로드</label>
                <input type="file" display="none" class="filebox" name="item_file" id="item_file" multiple />
                <input type="text" class="upload-name-file" readonly="readonly" disabled="disabled" />
            </div>
        </div>

        <!-- /.card -->
        <div class="card card-outline-secondary my-1">
            <div class="input-group-text">Item Desc</div>
            <textarea class="form-control" name="item_desc" id="item_desc"
                style="resize: none;height:200px;width:100%"></textarea>
        </div>

        <input type="button" class="btn btn-warning btn-block" value="add" id="add_item">
        <!-- /.card -->

    </div>
    <!-- /.col-lg-9 -->




    <!-- Bootstrap core JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
    <!-- Third party plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Contact form JS-->
    <script src="../mail/jqBootstrapValidation.js"></script>
    <script src="../mail/contact_me.js"></script>
    <script>
        $(document).ready(function () {
            var category = JSON.parse('<%- category %>');
            var carbrand = JSON.parse('<%- carbrand %>');
            var itembrand = JSON.parse('<%- itembrand %>');
            for (var i = 0; i < category.length; i++) {
                $("#category_main").append(
                    '<option value = "' + category[i].MAIN + '">' + category[i].MAIN + '</option>'
                );
            }

            for (var i = 0; i < carbrand.length; i++) {
                $("#car_brand").append(
                    '<option value = "' + carbrand[i].NAME + '">' + carbrand[i].NAME + '</option>'
                );
            }

            for (var i = 0; i < itembrand.length; i++) {
                $("#item_brand").append(
                    '<option value = "' + itembrand[i].NAME + '">' + itembrand[i].NAME + '</option>'
                );
            }

            $("#category_main").change(function () {
                var main = $("#category_main option:selected").val();
                if (main != "") {
                    $("#category_sub").html('<option selected></option>');

                    $.ajax({
                        url: "/item/add/category",
                        type: "post",
                        data: {
                            main: main
                        },
                        success: function (data) {
                            var sub = JSON.parse(data);
                            for (var j = 0; j < sub.length; j++) {
                                $("#category_sub").append(
                                    '<option value = "' + sub[j].SUB + '">' + sub[j]
                                    .SUB + '</option>'
                                );
                            }
                            $("#category_sub").attr("disabled", false);
                        }
                    })
                }
            })

            var fileTarget = $("#item_file");
            console.log(fileTarget);
            fileTarget.on("change", function(){ // 값이 변경되면

                var file_len = $('#item_file')[0].files.length;
                if(file_len==1){
                    if(window.FileReader){ // modern browser
                        var filename = $(this)[0].files[0].name;
                    }
                    else { // old IE
                        var filename = $(this).val().split('/').pop().split('\\').pop(); // 파일명만 추출
                    } // 추출한 파일명 삽입
                    $(this).siblings(".upload-name-file").val(filename);
                }
                else if(file_len>1){
                    var text = "파일 "+file_len+"개"
                    $(this).siblings(".upload-name-file").val(text);
                }
            });

            var imgTarget = $("#item_img");
            imgTarget.on("change", function(){ // 값이 변경되면

                var img_len = $("#item_img")[0].files.length;
                if(img_len==1){
                    if(window.FileReader){ // modern browser
                        var imgname = $(this)[0].files[0].name;
                    }
                    else { // old IE
                        var imgname = $(this).val().split('/').pop().split('\\').pop(); // 파일명만 추출
                    } // 추출한 파일명 삽입}
                    $(this).siblings(".upload-name-img").val(imgname);
                }
                else if(img_len>1){
                    var text = "사진 "+img_len+"개"
                    $(this).siblings(".upload-name-img").val(text);
                }
            });

            //insert img and check it
            $("#item_img").on("change", function () {
                var file = $('#item_img')[0].files;
                var img_file;
                //  console.log(file.length);
                if (file.length > 5) {
                    alert("size over");
                    $('#item_img').val("");
                    return;
                } else {
                    for (var i = 0; i < file.length; i++) {
                        img_file = file[i];
                        var src = URL.createObjectURL(img_file);
                        $("#top-img-" + i + " img").attr('src', src);
                        $("#thumb-img-" + i + " img").attr('src', src);
                    }
                }
            })

            $("#add_item").off("click").on("click", function () {
                const formdata = new FormData($("form")[0]);
                formdata.append("item_img", $('#item_img')[0].files[0]);
                formdata.append("item_img", $('#item_img')[0].files[1]);
                formdata.append("item_img", $('#item_img')[0].files[2]);
                formdata.append("item_img", $('#item_img')[0].files[3]);
                formdata.append("item_img", $('#item_img')[0].files[4]);
                var file_length = $('#item_file')[0].files.length;
                if (file_length <= 5) {
                    for (var i = 0; i < file_length; i++) {
                        formdata.append("file", $('#item_file')[0].files[i]);
                    }
                    var desc = $("#item_desc").val();
                    formdata.append("item_desc", desc);
                    $.ajax({
                        url: "/admin/item/add",
                        type: "post",
                        data: formdata,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Add item',
                                text: 'PIN: ' + data,

                            }).then(function () {
                                location.reload();
                            })
                        },
                        error: function () {
                            alert("error");
                        }
                    })
                } else {
                    alert("too many files");
                }

            })

            var galleryThumbs = new Swiper('.gallery-thumbs', {
                spaceBetween: 10,
                slidesPerView: 5,
                loop: true,
                freeMode: true,
                loopedSlides: 5, //looped slides should be the same
                watchSlidesVisibility: true,
                watchSlidesProgress: true,
            });
            var galleryTop = new Swiper('.gallery-top', {
                spaceBetween: 10,
                loop: true,
                loopedSlides: 5, //looped slides should be the same
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                thumbs: {
                    swiper: galleryThumbs,
                },
            });

        })
    </script>


</body>

</html>
