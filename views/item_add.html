<!DOCTYPE html>
<html lang="en">

<head>
	<title>AUTOINMall</title>
	<%- include('head') %>
	<style>

		body {
			font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
			font-size: 14px;
			color: #000;
			margin: 0;
			padding: 0;
		}

		.swiper-container {
			background: silver;
			width: 100%;
			height: 300px;
			margin-left: auto;
			margin-right: auto;
		}

		.swiper-slide {

			background-size: cover;
			background-position: center;
		}

		.gallery-top {
			border-top: black solid 1px;
			border-left: black solid 1px;
			border-right: black solid 1px;
			margin-top: 7%;
			height: 60%;
			width: 100%;
		}

		.gallery-thumbs {
			border-bottom: black solid 1px;
			border-left: black solid 1px;
			border-right: black solid 1px;
			height: 20%;
			box-sizing: border-box;
			padding: 10px 0;
		}

		.gallery-thumbs .swiper-slide {
			height: 100%;
			opacity: 0.4;
		}

		.gallery-thumbs .swiper-slide-thumb-active {
			opacity: 1;
		}
	</style>

</head>

<body>
	<div class="container">
		<div class="row" id="item_info_row">
			<div class="col-sm-6">
				<!-- Swiper -->
				<div class="swiper-container gallery-top">
					<div class="swiper-wrapper">
						<div class="swiper-slide" id="top-img-0">
							<img height="150" src="/img/item/no_img.png" width="380">
						</div>
						<div class="swiper-slide" id="top-img-1">
							<img height="150" src="/img/item/no_img.png" width="380">
						</div>
						<div class="swiper-slide" id="top-img-2">
							<img height="150" src="/img/item/no_img.png" width="380">
						</div>
						<div class="swiper-slide" id="top-img-3">
							<img height="150" src="/img/item/no_img.png" width="380">
						</div>
						<div class="swiper-slide" id="top-img-4">
							<img height="150" src="/img/item/no_img.png" width="380">
						</div>
					</div>
					<!-- Add Arrows -->
					<div class="swiper-button-next swiper-button-black"></div>
					<div class="swiper-button-prev swiper-button-black"></div>
				</div>
				<div class="swiper-container gallery-thumbs">
					<div class="swiper-wrapper">
						<div class="swiper-slide" id="thumb-img-0">
							<img src="/img/item/no_img.png" style="width:80%;height:70%">
						</div>
						<div class="swiper-slide" id="thumb-img-1">
							<img src="/img/item/no_img.png" style="width:80%;height:70%">
						</div>
						<div class="swiper-slide" id="thumb-img-2">
							<img src="/img/item/no_img.png" style="width:80%;height:70%">
						</div>
						<div class="swiper-slide" id="thumb-img-3">
							<img src="/img/item/no_img.png" style="width:80%;height:70%">
						</div>
						<div class="swiper-slide" id="thumb-img-4">
							<img src="/img/item/no_img.png" style="width:80%;height:70%">
						</div>
					</div>
				</div>
				<input accept="image/*" id="item_img" multiple name="item_img" style="margin-top:2%;border:black solid 1px;width:100%"
					   type="file">

			</div>

			<div class="col-sm-6" id="item_head">
				<form>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Item name</span></div>
						<input class="form-control" id="item_name" name="item_name" type="text">
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Price</span></div>
						<input class="form-control" id="item_price" name="item_price" type="text">
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Parts Num</span></div>
						<input class="form-control" id="parts_num" name="parts_num" type="text">
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Quantity</span></div>
						<input class="form-control" id="item_volume" name="item_volume" type="text">
					</div>
					<div class="input-group mb-1">

						<span class="input-group-text">Model</span>
						<input class="form-control" id="item_model" name="item_model" type="text">

						<span class="input-group-text">Version</span>
						<input class="form-control" id="item_version" name="item_version" type="text">
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Car Brand</span></div>
						<select class="custom-select" id="car_brand" name="car_brand">
							<option selected></option>
						</select>
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Item Brand</span></div>
						<select class="custom-select" id="item_brand" name="item_brand">
							<option selected></option>
						</select>
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Item manuf</span></div>
						<input class="form-control" id="item_manuf" name="item_manuf" type="text">
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Category Main</span></div>
						<select class="custom-select" id="category_main" name="category_main">
							<option selected></option>
						</select>
					</div>
					<div class="input-group mb-1">
						<div class="input-group-prepend">
							<span class="input-group-text">Category Sub</span></div>
						<select class="custom-select" disabled id="category_sub" name="category_sub">
							<option selected></option>
						</select>
					</div>
				</form>
			</div>

		</div>

		<div class="input-group mb-1">
			<div class="input-group-prepend">
				<span class="input-group-text">Download Files</span></div>
			<div>
				<input class="form-control" id="item_file" multiple name="item_file" type="file">
			</div>
		</div>
		<!-- /.card -->
		<div class="card card-outline-secondary my-1">
			<div class="input-group-text">Item Desc</div>
			<textarea class="form-control" id="item_desc" name="item_desc"
					  style="resize: none;height:200px;width:100%"></textarea>
		</div>
		<input class="btn btn-success btn-block" id="add_item" type="button" value="add">
	</div>

	<script>
		$(document).ready(function () {
			var category = JSON.parse('<%- category %>');
			var carbrand = JSON.parse('<%- carbrand %>');
			var itembrand = JSON.parse('<%- itembrand %>');
			for (var i = 0; i < category.length; i++) {
				$("#category_main").append(
					'<option value = "' + category[i].MAIN + '">' + category[i].MAIN + '</option>'
				);
			}

			for (var i = 0; i < carbrand.length; i++) {
				$("#car_brand").append(
					'<option value = "' + carbrand[i].NAME + '">' + carbrand[i].NAME + '</option>'
				);
			}

			for (var i = 0; i < itembrand.length; i++) {
				$("#item_brand").append(
					'<option value = "' + itembrand[i].NAME + '">' + itembrand[i].NAME + '</option>'
				);
			}

			$("#category_main").change(function () {
				var main = $("#category_main option:selected").val();
				if (main !== "") {
					$("#category_sub").html('<option selected></option>');

					$.ajax({
						url: "/item/add/category",
						type: "post",
						data: {main: main},
						success: function (data) {
							var sub = JSON.parse(data);
							for (var j = 0; j < sub.length; j++) {
								$("#category_sub").append(
									'<option value = "' + sub[j].SUB + '">' + sub[j].SUB + '</option>'
								);
							}
							$("#category_sub").attr("disabled", false);
						}
					})
				}


			})

			//insert img and check it
			$("#item_img").on("change", function () {
				var file = $('#item_img')[0].files;
				var img_file;
				//  console.log(file.length);
				if (file.length > 5) {
					alert("size over");
					$('#item_img').val("");
					return;
				} else {
					for (var i = 0; i < file.length; i++) {
						img_file = file[i];
						var src = URL.createObjectURL(img_file);

						$("#top-img-" + i + " img").attr('src', src);

						$("#thumb-img-" + i + " img").attr('src', src);

					}

				}


			})
			$("#add_item").off("click").on("click", function () {
				const formdata = new FormData($("form")[0]);
				formdata.append("item_img", $('#item_img')[0].files[0]);
				formdata.append("item_img", $('#item_img')[0].files[1]);
				formdata.append("item_img", $('#item_img')[0].files[2]);
				formdata.append("item_img", $('#item_img')[0].files[3]);
				formdata.append("item_img", $('#item_img')[0].files[4]);
				var file_length = $('#item_file')[0].files.length;
				if (file_length <= 5) {
					for (var i = 0; i < file_length; i++) {
						formdata.append("file", $('#item_file')[0].files[i]);
					}
					var desc = $("#item_desc").val();
					formdata.append("item_desc", desc);
					$.ajax({
						url: "/admin/item/add",
						type: "post",
						data: formdata,
						contentType: false,
						processData: false,
						success: function (data) {
							Swal.fire({
								icon: 'success',
								title: 'Add item',
								text: 'PIN: ' + data,

							}).then(function () {
								location.reload();
							})
						},
						error: function () {
							alert("error");
						}
					})
				} else {
					alert("too many files");
				}

			})

			var galleryThumbs = new Swiper('.gallery-thumbs', {
				spaceBetween: 10,
				slidesPerView: 5,
				loop: true,
				freeMode: true,
				loopedSlides: 5, //looped slides should be the same
				watchSlidesVisibility: true,
				watchSlidesProgress: true,
			});
			var galleryTop = new Swiper('.gallery-top', {
				spaceBetween: 10,
				loop: true,
				loopedSlides: 5, //looped slides should be the same
				navigation: {
					nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev',
				},
				thumbs: {
					swiper: galleryThumbs,
				},
			});

		})
	</script>
</body>
</html>
